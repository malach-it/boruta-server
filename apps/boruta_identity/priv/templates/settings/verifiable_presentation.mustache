<h1>Credential presentation</h1>

{{^valid?}}
<div class="ui error message">
{{#errors}}
  <li>{{ message }}</li>
{{/errors}}
</div>
{{/valid?}}

<h2>Scan the QR code with your identity wallet</h2>
<hr />
<div class="ui center aligned qr-code segment">
  <img width="350" src="data:image/svg+xml; base64, {{ base64_presentation_qr_code }}" alt="QR code" />
</div>
<div id="error"></div>
<div class="ui center aligned deeplink segment">
  <button class="ui blue fluid button" target="_blank" onclick="window.open('{{ presentation_deeplink }}', 'Present your credential', 'height=800,width=400')">Present your credentials</button>
</div>
<hr />
<a href="#" onclick="window.location.reload()" class="ui fluid button">Reload</a>
<script>
  var container = document.getElementById('error')
  var source = new EventSource('{{ issuer }}/openid/presentation_sse?code={{ code }}');

  source.addEventListener('authenticated', function(event) {
      console.log(event)
      window.location.href = event.data
    })
  source.addEventListener("authentication_failure", (event) => {
    container.innerHTML = ''
    var error = document.createElement('div')
    error.classList.add('ui')
    error.classList.add('error')
    error.classList.add('message')

    error.textContent = event.data

    container.append(error)
    });
</script>
